// OpenSCAD: тестовые кольца для проверки толщины стенок
// Версия: 1.0 — набор колец с разной толщиной стенок и текстовыми метками

description = "Test rings with different wall thicknesses (1, 1.6, 2mm) for 3D printing calibration";

use <../modules.scad>;

// ===== Точность аппроксимации окружностей =====
$fn = 0;        // фиксированную сегментацию отключаем
$fa = 6;        // 5–8° обычно достаточно
$fs = 0.35;     // ≈ диаметр сопла (0.3–0.5 для сопла 0.4)
pin_fs = 0.25;  // чуть тоньше для штырей и отверстий

// ===== Режим печати тест‑фрагментов =====
test_fragment = false;   // true — печатать только угловые фрагменты
frag_size     = 20;      // размер квадрата вырезки, мм
frag_index    = 0;       // 0=НЛ, 1=ВЛ, 2=НП, 3=ВП (относительно основания)
frag_gap_x    = 10;      // зазор между фрагментами по X, мм
frag_h_extra  = 20;      // запас по высоте клипа, мм

// ===== Общие доп. параметры =====
tiny = 0.1;                  // небольшой зазор для булевых операций
edge_chamfer_z = 1;          // высота фаски по Z (мм)
edge_chamfer_x = 5;          // горизонтальный вылет фаски по X (с каждой стороны), мм
edge_chamfer_y = 5;          // горизонтальный вылет фаски по Y (с каждой стороны), мм
screen_frame_gap = 0.2;      // только для высоты вычитаний в рамке (не влияет на XY)

// ===== Параметры модели =====
ring_diam = 20;              // внешний диаметр кольца, мм
ring_height = 10;             // высота кольца, мм
ring_thicknesses = [1, 1.6, 2]; // массив толщин стенок, мм
ring_spacing = 5;             // расстояние между кольцами по оси X, мм

// ===== Параметры текста =====
text_size = 4;                // размер шрифта, мм
text_height = 1;            // высота текста (толщина выдавливания), мм

// ===== Комментарии ===========================
/*
Модель: тестовые кольца для проверки толщины стенок при 3D печати
Блоки:
- Переменные (вверху) для всех размеров
- Комментарии (этот блок)
- Функции фрагментов детали (ниже)
- Функция вывода всех фрагментов show_all()
- Функция обрезки через intersection при test_fragment=true

Детали: 
- ring_1mm, ring_1_6mm, ring_2mm — кольца с разной толщиной стенок
- text_1mm, text_1_6mm, text_2mm — текстовые метки на боковой поверхности (XZ плоскость)

План: создаём кольца как разность двух цилиндров, добавляем текст на боковую поверхность
Текст размещается на XZ плоскости (вид сбоку) для удобного чтения
*/

// ===== Вспомогательные функции ====================
function clamp(val, lo, hi) = max(lo, min(val, hi));

// ===== Модули деталей ====================
// Модуль для создания одного кольца
module ring(thickness) {
  difference() {
    cylinder(h=ring_height, d=ring_diam, $fs=pin_fs, $fa=6);
    translate([0, 0, -tiny])
      cylinder(h=ring_height + 2*tiny, d=ring_diam - 2*thickness, $fs=pin_fs, $fa=6);
  }
}

// Модуль для текста на боковой поверхности кольца (XZ плоскость)
module ring_text(thickness_value) {
  text_str = str(thickness_value);
  // Размещаем текст на боковой поверхности (XZ плоскость)
  // Центрируем по высоте и размещаем на внешней поверхности кольца
  // Текст размещается на передней стороне для видимости на XZ плоскости (вид сбоку)
  // Позиция: на внешнем радиусе кольца, по центру высоты, слегка выступает наружу
  translate([0, -(ring_diam - thickness_value)/2 - text_height/2, ring_height/2])
    rotate([90, 0, 0])
      linear_extrude(height=text_height, center=false)
        text(text_str, size=text_size, halign="center", valign="center");
}

// Модуль для одного кольца с текстом
module ring_with_text(thickness_value, x_offset) {
  translate([x_offset, 0, 0]) {
    ring(thickness_value);
    ring_text(thickness_value);
  }
}

// ===== Вывод всех фрагментов ====================
module show_all() {
  clip_for_fragments() {
    // Вычисляем позиции для каждого кольца
    for (i = [0 : len(ring_thicknesses) - 1]) {
      x_pos = i * (ring_diam + ring_spacing);
      ring_with_text(ring_thicknesses[i], x_pos);
    }
  }
}

// ===== Точка входа ====================
show_all();
