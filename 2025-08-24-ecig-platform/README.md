
Этот улучшенный 

# Подставка для электронной сигареты

Параметрическая модель подставки с внутренним "стаканом" под овально-прямоугольный корпус электронной сигареты. Модель автоматически адаптируется под размеры устройства и создаёт эргономичную подставку с фасками и скруглениями.

## Особенности модели

- **Анизотропные пропорции**: Учёт разных размеров по осям X и Y для естественных форм
- **Автоматическая адаптация**: Размеры подстраиваются под габариты устройства
- **Технологичность**: Зазоры для посадки и фаски для удобства использования
- **Модульность**: Легкая адаптация под другие устройства изменением параметров
- **Режим тестирования**: Возможность печати фрагментов для проверки посадки

## Полезные приёмы OpenSCAD

### 1. **Анизотропные скругления с Minkowski**
```scad
module rounded_rect2d_aniso(w, h, rx, ry) {
    rx2 = min(rx, w/2);
    ry2 = min(ry, h/2);
    minkowski() {
        square([max(w - 2*rx2, tiny), max(h - 2*ry2, tiny)], center=true);
        scale([rx2, ry2]) circle(r=1);
    }
}
```
**Приём**: Создание прямоугольников с разными радиусами скругления по осям X и Y. Использование `scale()` внутри Minkowski позволяет создавать эллиптические скругления.

### 2. **Компенсация искажений при масштабировании**
```scad
// Компенсируем анизотропное масштабирование
rr_bottom = cup_r_ratio * (sy / sx);

linear_extrude(height=base_h, scale=[sx, sy])
    base_profile2d(base_w, base_t, rr_bottom);
```
**Приём**: Математическая компенсация искажений пропорций при линейной экструзии с масштабированием. Это сохраняет желаемые пропорции скруглений на верхней кромке.

### 3. **Умный режим автоматического сужения**
```scad
taper_mode = "auto";      // "auto" | "manual"

if (taper_mode=="auto") {
    top_w_auto = cup_w + 2*edge_chamfer_x + 2*rim_w;
    taper_x = base_w - top_w_auto;
}
```
**Приём**: Автоматический расчёт сужения внешних стенок на основе размеров внутреннего стакана и фаски. Позволяет создавать плавные переходы без ручных вычислений.

### 4. **Защита от некорректной геометрии**
```scad
function min(rx, w/2) // Ограничение радиуса половиной ширины
r2 = min(r, min(w, h)/2); // Двойная защита
```
**Приём**: Автоматическое ограничение параметров для предотвращения некорректной геометрии. Особенно важно для скруглений, которые не должны превышать половину размера стороны.

### 5. **Параметрические профили с пропорциями**
```scad
module cup_profile2d(w, h) {
    ry = min(h/2, w/(2*cup_r_ratio));
    rx = min(w/2, cup_r_ratio*ry);
    rounded_rect2d_aniso(w, h, rx, ry);
}
```
**Приём**: Создание профилей с параметрическими пропорциями, которые автоматически адаптируются к размерам. Отношение радиусов `cup_r_ratio` сохраняется независимо от размеров.

### 6. **Модульная структура с чётким разделением**
```scad
// ====================== Блок 1: Параметры =====================
// ====================== Блок 2: Вспомогательные функции =====================
// ====================== Блок 3: Основная геометрия =====================
// ====================== Блок 4: Тестовые функции =====================
```
**Приём**: Чёткое разделение кода на логические блоки с визуальными разделителями. Упрощает навигацию и понимание структуры.

### 7. **Тернарные операторы для режимов**
```scad
taper_x = (taper_mode=="auto") ? (base_w - top_w_auto) : manual_outer_taper_total_x;
```
**Приём**: Использование тернарного оператора для выбора между автоматическим и ручным режимами. Более компактно и читаемо, чем if-else конструкции.

### 8. **Система тестовых фрагментов**
```scad
module corner_clipper(i=0) {
    // 0=НЛ, 1=ВЛ, 2=НП, 3=ВП
    dx = (i==0 || i==1) ? -(base_w/2 - frag_size/2) : (base_w/2 - frag_size/2);
    dy = (i==0 || i==2) ? -(base_t/2 - frag_size/2) : (base_t/2 - frag_size/2);
}
```
**Приём**: Создание системы для тестирования отдельных углов модели. Позволяет экономить время и материал при проверке посадки.

### 9. **Комбинирование булевых операций**
```scad
difference() {
    base_solid();  // Основная форма
    cup_cut();     // Вырез стакана с фаской
}
```
**Приём**: Использование булевых операций для создания сложных форм из простых примитивов. Разделение на логические компоненты упрощает отладку.

### 10. **Параметрические зазоры и допуски**
```scad
fit_gap = 0.30; // технологический зазор на сторону, мм
cup_w = cig_w + 2*fit_gap;
```
**Приём**: Автоматический расчёт размеров с учётом технологических зазоров. Централизованное управление допусками упрощает настройку.

### 11. **Условный рендеринг с дублированием**
```scad
module show_all() {
    if (!test_fragment) {
        base();
    } else {
        translate([- (frag_size/2 + frag_gap_x/2), 0, 0])
            intersection() { base(); corner_clipper(frag_index); }
        translate([  (frag_size/2 + frag_gap_x/2), 0, 0])
            intersection() { base(); corner_clipper(frag_index); }
    }
}
```
**Приём**: Дублирование фрагментов для сравнения и тестирования. Полезно для проверки симметрии и качества печати.

### 12. **Версионирование модели**
```scad
// MODEL_VERSION = "v1.3.1"  // обновляйте номер при изменениях
```
**Приём**: Отслеживание версий модели для контроля изменений и совместимости.

## Параметры для настройки

### Основные размеры
- `cig_w = 26.3` - ширина корпуса сигареты (длинная ось), мм
- `cig_t = 15.0` - толщина корпуса (короткая ось), мм
- `cup_depth = 15.0` - глубина стакана, мм

### Посадка и зазоры
- `fit_gap = 0.30` - технологический зазор для посадки, мм
- `base_margin = 10.0` - отступ основания от габаритов устройства, мм

### Скругления и пропорции
- `cup_r_ratio = 0.75` - отношение радиусов скругления (ширина/высота)
- `base_round_r = 6.0` - максимальный радиус скругления основания, мм

### Фаски
- `edge_chamfer_z = 1.0` - высота фаски верхней кромки, мм
- `edge_chamfer_x = 1.5` - вылет фаски по X, мм
- `edge_chamfer_y = 1.5` - вылет фаски по Y, мм

### Режимы работы
- `taper_mode = "auto"` - режим сужения ("auto" или "manual")
- `test_fragment = false` - режим тестирования фрагментов

## Примеры использования

### Адаптация под другое устройство
```scad
// Для устройства 30x20 мм
cig_w = 30.0;
cig_t = 20.0;
fit_gap = 0.25; // Более плотная посадка
```

### Создание более высокого стакана
```scad
cup_depth = 25.0; // Увеличиваем глубину
base_h = cup_depth + bottom_floor; // Автоматически пересчитывается
```

### Ручное управление сужением
```scad
taper_mode = "manual";
manual_outer_taper_total_x = 20.0; // Больше сужение по X
manual_outer_taper_total_y = 10.0; // Меньше сужение по Y
```

## Советы по печати

1. **Ориентация**: Печатайте основанием вниз для лучшего качества поверхности
2. **Поддержки**: Обычно не требуются благодаря конической форме
3. **Точность**: Используйте `$fs = 0.35` для сопла 0.4мм
4. **Тестирование**: Сначала напечатайте фрагмент (`test_fragment = true`) для проверки посадки

## Возможные улучшения

- Добавление текстуры на дно стакана для лучшего сцепления
- Создание варианта с отверстиями для вентиляции
- Добавление крепёжных элементов для фиксации на поверхности
- Создание версии с несколькими гнёздами для разных устройств


